#!/usr/bin/env bash

if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
  echo "This script should be sourced, not executed directly. Please run 'source $0' instead."
  exit 1
fi

function update-fork-networks-shortcuts() {
  networks="$(jq -r '.network_names | keys[]' ~/mesc.json)"

  for network in $networks; do
    # mesc queries by network name are buggy, so we query by chainId
    local chainId="$(jq -r ".network_names[\"$network\"]" ~/mesc.json)"
    local url="$(mesc url --network $chainId)"
    eval "function fork-${network}() { anvil --fork-url $url \$@ ; }"
  done

  eval "function set-fork-rpc-arbitrum() { export ARBITRUM_RPC='http://127.0.0.1:8545'; }"
  eval "function set-fork-rpc-arbitrumSepolia() { export ARBITRUM_SEPOLIA_RPC='http://127.0.0.1:8545'; }"
  
  eval "function unset-fork-rpc-arbitrum() { unset ARBITRUM_RPC; }"
  eval "function unset-fork-rpc-arbitrumSepolia() { unset ARBITRUM_SEPOLIA_RPC; }"
}
